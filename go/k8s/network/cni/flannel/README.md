

# Flannel
主要实现两个功能:
* 为每个 node 分配 subnet，容器将自动从该子网中获取 IP 地址
* 当有 node 加入到网络中时，为每个 node 增加路由配置


# Vxlan 通信过程
对于处于同一个VXLAN的两台虚拟终端，其通信过程可以概括为如下的步骤：
1. 发送方向接收方发送数据帧，帧中包含了发送方和接收方的虚拟MAC地址
2. 发送方连接的VTEP节点收到了数据帧，通过查找发送方所在的VXLAN以及接收方所连接的VTEP节点，将该报文添加VXLAN首部、外部UDP首部、外部IP首部后，发送给目的VTEP节点
3. 报文经过物理网络传输到达目的VTEP节点
4. 目的VTEP节点接收到报文后，拆除报文的外部IP首部和外部UDP首部，检查报文的VNI以及内部数据帧的目的MAC地址，确认接收方与本VTEP节点相连后，拆除VXLAN首部，将内部数据帧交付给接收方
5. 接收方收到数据帧，传输完成

通过以上的步骤可以看出：VXLAN的实现细节以及通信过程对于处于VXLAN中的发送方和接收方是不可见的，基于发送方和接收方的视角，其通信过程和二者真实处于同一链路层网络中的情况完全相同。




# 参考文献
**[Kubernetes flannel网络分析](http://just4coding.com/2021/11/03/flannel/)**

**[动态维护FDB表项实现VXLAN通信](http://just4coding.com/2020/04/20/vxlan-fdb/)**

**[VXLAN原理介绍与实例分析](http://just4coding.com/2017/05/21/vxlan/)**

